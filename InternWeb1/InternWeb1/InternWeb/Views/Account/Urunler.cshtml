@using InternWeb.ViewModels;
@using InternWeb.Models;
@using Newtonsoft.Json
@Html.AntiForgeryToken()

<ProductViewModel>

@{
    ViewData["Title"] = "Ürünler";
}

<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>
        <!-- DataTables CSS -->
        <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
        <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">

        @* <!-- Bootstrap CSS -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet"> *@

        <!-- Google Font: Source Sans Pro -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <!-- Bootstrap 5 Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Other Styles -->
        <link rel="stylesheet" href="~/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
        <link rel="stylesheet" href="~/plugins/jqvmap/jqvmap.min.css">
        <link rel="stylesheet" href="~/dist/css/adminlte.min.css">
        <link rel="stylesheet" href="~/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
        <link rel="stylesheet" href="~/plugins/daterangepicker/daterangepicker.css">
        <link rel="stylesheet" href="~/plugins/summernote/summernote-bs4.min.css">

</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="/Account/Dashboard" class="nav-link">Home</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" class="nav-link">Contact</a>
                </li>
            </ul>

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Navbar Search -->
                <li class="nav-item">
                    <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                        <i class="fas fa-search"></i>
                    </a>
                    <div class="navbar-search-block">
                        <form class="form-inline">
                            <div class="input-group input-group-sm">
                                <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-navbar" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>

                <!-- Messages Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-comments"></i>
                        <span class="badge badge-danger navbar-badge">3</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Brad Diesel
                                        <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">Call me whenever you can...</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        John Pierce
                                        <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">I got your message bro</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Nora Silvester
                                        <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">The subject goes here</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
                    </div>
                </li>
                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge">15</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-header">15 Notifications</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-envelope mr-2"></i> 4 new messages
                            <span class="float-right text-muted text-sm">3 mins</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-users mr-2"></i> 8 friend requests
                            <span class="float-right text-muted text-sm">12 hours</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-file mr-2"></i> 3 new reports
                            <span class="float-right text-muted text-sm">2 days</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
                        <i class="fas fa-th-large"></i>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/Account/Dashboard" class="brand-link">

                <span class="brand-text font-weight-light">AdminLTE 3</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">

                    <div class="info">
                        <a href="/Account/Dashboard" class="d-block">Alexander Pierce</a>
                    </div>
                </div>

                <!-- SidebarSearch Form -->
                <div class="form-inline">
                    <div class="input-group" data-widget="sidebar-search">
                        <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
                        <div class="input-group-append">
                            <button class="btn btn-sidebar">
                                <i class="fas fa-search fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <!-- Add icons to the links using the .nav-icon class
                             with font-awesome or any other icon font library -->
                        <li class="nav-item menu-open">
                            <a href="#" class="nav-link active">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                 <p>
                                    Starter Pages
                                    <i class="right fas fa-angle-left"></i>
                                </p> 
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="/Account/activities" class="nav-link ">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Activities</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/Profile" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>profile</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/calendar" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>calendar</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#" class="nav-link" data-toggle="modal" data-target="#urunEkleModal">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Yeni İlan Ekle</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/Dryak" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>user</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/Urunler" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Ürünler</p>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item menu-is-opening menu-open">
                            <a href="#" class="nav-link active">
                                <i class="nav-icon far fa-envelope"></i>
                                <p>
                                    Mailbox
                                    <i class="fas fa-angle-left right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview" style="display: block;">
                                <li class="nav-item">
                                    <a href="/Account/mailbox" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Inbox</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/compose" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Compose</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/Account/readmail" class="nav-link ">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Read</p>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    Simple Link
                                </p>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <style>
            .content-wrapper {
                text-align: left; /* Ensure left alignment */
            }
        </style>

        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        @* <div class="col-sm-6">
                            <h1 class="m-0">Starter Page</h1>
                        </div><!-- /.col --> *@
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                @* <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Starter Page</li> *@
                            </ol>
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                </div><!-- /.container-fluid -->
            </div>
            <!-- /.content-header -->
            <!-- Main content -->
            <div class="content">
                <div class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1 class="m-0 text-primary">Ürün Listesi</h1>
                            </div>
                                <div class="d-flex justify-content-end">
                                    <!-- Yeni İlan Ekle Butonu -->
                                    <button type="button" class="btn btn-primary" id="yeniIlanEkleBtn">Yeni İlan Ekle</button>

                                </div>
                        </div>
                    </div>
                </div>
                    <!-- Modal HTML yapısı -->
                    <div class="modal fade" id="urunEkleModal" tabindex="-1" aria-labelledby="urunEkleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Ürün Ekle</h4>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" id="modalBodyContent">
                                    <!-- Modal içeriği AJAX ile yüklenecek -->
                                </div>
                            </div>
                        </div>
                    </div>
                   

                <section class="content">
                    <div class="container-fluid">
                        @if (TempData["ErrorMessage"] != null)
                        {
                            <div class="alert alert-danger">
                                @TempData["ErrorMessage"]
                            </div>
                        }

                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="productsTable" class="table table-bordered table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Kategori ID</th>
                                                        <th>Ürün Adı</th>
                                                        <th>Ürün Açıklama</th>
                                                        <th>Ürün Fiyat</th>
                                                        <th>Ürün Stok</th>
                                                        <th>Ürün Durum</th>
                                                        <th>Ürün Görsel</th>
                                                        <th>İşlemler</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var product in Model)
                                                    {
                                                        <tr>
                                                            <td>@product.id</td>
                                                            <td>@product.kategoriId</td>
                                                            <td>@product.urunAdi</td>
                                                            <td>@product.urunAciklama</td>
                                                            <td>@product.urunFiyat</td>
                                                            <td>@product.urunStok</td>
                                                            <td>@(product.urunDurum == "1" ? "Aktif" : "Pasif")</td>
                                                            <td>
                                                                @if (!string.IsNullOrEmpty(product.urunGorsel))
                                                                {
                                                                    <img src="@product.urunGorsel" alt="Ürün Görseli" style="max-width: 100px; max-height: 100px;" />
                                                                }
                                                                else
                                                                {
                                                                    <span>Görsel yok</span>
                                                                }
                                                            </td>
                                                            <td>
                                                                <!-- İşlem butonları buraya -->
                                                                    <div class="btn-group" role="group">
                                                                    <a href="#" class="btn btn-success ms-2" data-toggle="modal" data-target="#urunEkleModal">Düzenle</a>
                                                                        <a asp-controller="Account" asp-action="Delete" asp-route-id="@product.id" class="btn btn-danger mx-2">
                                                                            <i class="bi bi-trash3-fill"></i> Sil
                                                                        </a>
                                                                    </div>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                            
                                        </div>
                                    </div>
                                    <!-- /.card-body -->
                                </div>
                                <!-- /.card -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                    </div>
                    <!-- /.container-fluid -->
                </section>
                   
            </div>
            <!-- /.content -->
            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
                <div class="p-3">
                    <h5>Title</h5>
                    <p>Sidebar content</p>
                </div>
            </aside>
            <!-- /.control-sidebar -->
            <!-- Main Footer -->
            <footer class="main-footer">
                <!-- To the right -->
            </footer>
            <!-- ./wrapper -->
                <!-- REQUIRED SCRIPTS -->
            <!-- DataTables JS -->
               @*  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
                <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script> *@

                @section Scripts {
                    <script src="~/plugins/jquery/jquery.min.js"></script>
                    <script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
                    @* <script src="~/plugins/datatables/jquery.dataTables.min.js"></script> *@
                    @* <script src="~/plugins/datatables/dataTables.bootstrap4.min.js"></script> *@
                    <!-- jQuery -->
                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <!-- DataTables JS -->
                    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
                    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>

                    <script>
                        $(document).ready(function () {
                            // Yeni İlan Ekle Butonuna Tıklandığında Modalı Aç ve İçeriği Yükle
                            $('#yeniIlanEkleBtn').click(function () {
                                $.ajax({
                                    url: '/Account/UrunEkleForm',
                                    type: 'POST',
                                    success: function (response) {
                                        $('#modalBodyContent').html(response);
                                        $('#urunEkleModal').modal('show');
                                    },
                                    error: function (xhr, status, error) {
                                        console.error('Hata:', error);
                                    }
                                });
                            });

                            // DataTable yapılandırması
                            var table = $('#productsTable').DataTable({
                                "ajax": {
                                    "url": "@Url.Action("GetProducts", "Account")",
                                    "dataSrc": ""
                                },
                                "columns": [
                                    { "data": "id" },
                                    { "data": "kategoriId" },
                                    { "data": "urunAdi" },
                                    { "data": "urunAciklama" },
                                    { "data": "urunFiyat" },
                                    { "data": "urunStok" },
                                    { "data": "urunDurum", "render": function (data) { return data ? "Aktif" : "Pasif"; } },
                                    {
                                        "data": "urunGorsel", "render": function (data) {
                                            return data ? `<img src="data:image/png;base64,${data}" style="max-width: 100px; max-height: 100px;" />` : "Görsel yok";
                                        }
                                    },
                                    {
                                        "data": null, "render": function (data) {
                                            return `<div class="btn-group" role="group">
                                                                <a href="#" class="btn btn-primary ms-2" data-toggle="modal" data-target="#urunEkleModal" data-id="${data.id}">Düzenle</a>
                                                                <button type="button" class="btn btn-danger mx-2 delete-product" data-id="${data.id}"><i class="bi bi-trash3-fill"></i> Sil</button>
                                                            </div>`;
                                        }
                                    }
                                ]
                            });

                            // Silme butonu için tıklama olayı
                            $('#productsTable').on('click', '.delete-product', function () {
                                var productId = $(this).data('id');

                                if (confirm('Bu ürünü silmek istediğinizden emin misiniz?')) {
                                    $.ajax({
                                        url: `/Account/Delete/${productId}`,
                                        type: 'POST',
                                        success: function (result) {
                                            alert('Ürün başarıyla silindi.');
                                            table.ajax.reload();
                                        },
                                        error: function (xhr, status, error) {
                                            alert('Ürün silinirken bir hata oluştu.');
                                        }
                                    });
                                }
                            });
                        });
                        // $('.btn-close').on('click', function () {

                        //     $('.modal.fade.show').hide();
                        //     $('.modal-backdrop.fade.show').hide();
                        // })
                        
                    </script>
                }



                <script src="https://ddei5-0-ctp.trendmicro.com:443/wis/clicktime/v1/query?url=https%3a%2f%2fcode.jquery.com%2fjquery%2d3.6.0.min.js&umid=6DB5B853-1DE4-E906-8D7D-F2DAC02DA0A1&auth=414eb4d17bd52daab8ebdebbdf7e1a95c2eb82d9-972292ca308afd005379e1cc9d7201f58923cb2c"></script>

                <!-- jQuery UI -->
                <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
                <script src="https://ddei5-0-ctp.trendmicro.com:443/wis/clicktime/v1/query?url=https%3a%2f%2fcode.jquery.com%2fui%2f1.12.1%2fjquery%2dui.min.js&umid=6DB5B853-1DE4-E906-8D7D-F2DAC02DA0A1&auth=414eb4d17bd52daab8ebdebbdf7e1a95c2eb82d9-a5038e4fb6185bdefb63661a51b98d3e1621843f"></script>
</body>
</html>
